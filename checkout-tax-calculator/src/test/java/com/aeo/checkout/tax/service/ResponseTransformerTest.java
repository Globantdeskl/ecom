package com.aeo.checkout.tax.service;

import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertTrue;
import static org.junit.jupiter.api.Assertions.assertEquals;

import java.io.IOException;
import java.math.BigDecimal;
import java.net.SocketException;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentMatchers;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.MockitoAnnotations;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;

import com.aeo.checkout.tax.model.CalculateResponse;
import com.aeo.checkout.tax.service.exception.VertexAddressException;
import com.aeo.checkout.tax.service.exception.VertexException;
import com.aeo.checkout.tax.service.tools.TransformerTools;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;

import aeo.integration.vertex.client.JurisdictionLevelCodeType;
import aeo.integration.vertex.client.QuotationResponseType;
import aeo.integration.vertex.client.TaxesType;
import aeo.integration.vertex.client.TaxesType.Jurisdiction;

public class ResponseTransformerTest {
	
	private ResponseTransformer responseTransformer;
	
	@Mock
	private TransformerTools tools;
	
	@BeforeEach
	void setup() {
		MockitoAnnotations.initMocks(this);
		Mockito.when(tools.round(ArgumentMatchers.anyDouble())).thenCallRealMethod();
		responseTransformer = new ResponseTransformer(tools);
	}
	
	@Test
	void testCreateCalculateResponse() {
		CalculateResponse respUS = responseTransformer.createCalculateResponse(mockVertexResponseUS());
		assertNotNull(respUS);
		assertNotNull(respUS.getOrderTaxes());
		assertNotNull(respUS.getOrderTaxes().getShippingTaxes());
		assertNotNull(respUS.getOrderTaxes().getLineItemTaxes());
		assertFalse(respUS.getOrderTaxes().getLineItemTaxes().stream()
			.anyMatch(li -> "mockShippingGroupId".equalsIgnoreCase(li.getLineItemId())));
		assertEquals(0, Double.compare(
				mockVertexResponseUS().getTotalTax().doubleValue(), 
				respUS.getOrderTaxes().getTotalTax()));
		
		CalculateResponse respCA = responseTransformer.createCalculateResponse(mockVertexResponseCanada());
		assertNotNull(respCA);
		assertNotNull(respCA.getOrderTaxes());
		assertNotNull(respCA.getOrderTaxes().getShippingTaxes());
		assertNotNull(respCA.getOrderTaxes().getLineItemTaxes());
		assertFalse(respCA.getOrderTaxes().getLineItemTaxes().stream()
			.anyMatch(li -> "mockShippingGroupId".equalsIgnoreCase(li.getLineItemId())));
		assertEquals(0, Double.compare(
				mockVertexResponseCanada().getTotalTax().doubleValue(), 
				respCA.getOrderTaxes().getTotalTax()));
		assertTrue(respCA.getOrderTaxes().getLineItemTaxes().stream()
			.allMatch(li -> (li.getCountryTaxType()!=null || li.getStateTaxType()!=null || li.getState()!=null) ));
	}
	
	@Test
	void testCalculateResponseCoverageConditions() {
		
		QuotationResponseType badTotal = mockVertexResponseUS();
		badTotal.setTotalTax(BigDecimal.valueOf(10.00));
		CalculateResponse badTotalResp = responseTransformer.createCalculateResponse(badTotal);
		assertNotNull(badTotalResp);
		
		QuotationResponseType badItems = mockVertexResponseUS();
		badItems.getLineItem().get(0).setTotalTax(BigDecimal.valueOf(10.00));
		badItems.getLineItem().get(0).setExtendedPrice(BigDecimal.valueOf(0.00));
		CalculateResponse badItemsResp = responseTransformer.createCalculateResponse(badItems);
		assertNotNull(badItemsResp);
		
		QuotationResponseType extraJurisdictions = mockVertexResponseCanada();
		TaxesType countryTax = mockJurisdictionTaxes(JurisdictionLevelCodeType.COUNTRY);
		countryTax.getJurisdiction().setValue("Brazil");
		extraJurisdictions.getLineItem().get(0).getTaxes().add(countryTax);
		extraJurisdictions.getLineItem().get(0).getTaxes().add(
				mockJurisdictionTaxes(JurisdictionLevelCodeType.CITY));
		extraJurisdictions.getLineItem().get(0).getTaxes().add(
				mockJurisdictionTaxes(JurisdictionLevelCodeType.LOCAL_IMPROVEMENT_DISTRICT));
		CalculateResponse extraJursResp = responseTransformer.createCalculateResponse(extraJurisdictions);
		assertNotNull(extraJursResp);
	}
	
	@Test
	void testCreateErrorResponse() {
		ResponseEntity<CalculateResponse> badAddressResp = responseTransformer.createErrorResponse(
				new VertexAddressException(VertexAddressException.BAD_ADDRESS_MSG), "mockOrderId");
		ResponseEntity<CalculateResponse> socketErrorResp = responseTransformer.createErrorResponse(
				new VertexException("Connection Reset", new SocketException("Connection Rest")), "mockOrderId");
		ResponseEntity<CalculateResponse> unknownErrorResp = responseTransformer.createErrorResponse(
				new VertexException(new Exception()), "mockOrderId");
		assertTrue(HttpStatus.BAD_REQUEST.equals(badAddressResp.getStatusCode()));
		assertTrue(VertexAddressException.BAD_ADDRESS_MSG.equals(badAddressResp.getBody().getErrorMessage()));
		assertTrue(HttpStatus.INTERNAL_SERVER_ERROR.equals(socketErrorResp.getStatusCode()));
		assertTrue("Connection Reset".equals(socketErrorResp.getBody().getErrorMessage()));
		assertTrue(HttpStatus.INTERNAL_SERVER_ERROR.equals(unknownErrorResp.getStatusCode()));
		assertNull(unknownErrorResp.getBody().getErrorMessage());
	}
	
	private TaxesType mockJurisdictionTaxes(JurisdictionLevelCodeType code) {
		TaxesType taxType = new TaxesType();
		taxType.setCalculatedTax(BigDecimal.valueOf(0.00));
		Jurisdiction jur = new Jurisdiction();
		jur.setJurisdictionLevel(code);
		taxType.setJurisdiction(jur);
		return taxType;
	}
	
	private QuotationResponseType mockVertexResponseUS() {
		String jsonStr = "{\"currency\":null,\"originalCurrency\":null,\"seller\":{\"company\":\"AEHoldings\",\"division\":\"AED\",\"department\":null,\"dispatcher\":null,\"physicalOrigin\":null,\"administrativeOrigin\":null,\"taxRegistration\":[],\"nexusIndicator\":null,\"nexusReasonCode\":null},\"customer\":{\"customerCode\":null,\"destination\":{\"streetAddress1\":\"ffffff\",\"streetAddress2\":null,\"city\":\"San Francisco\",\"mainDivision\":\"CA\",\"subDivision\":null,\"postalCode\":\"94107\",\"country\":\"US\",\"currencyConversion\":null,\"taxAreaId\":50759991,\"locationCustomsStatus\":null,\"locationCode\":null,\"externalJurisdictionCode\":null},\"administrativeDestination\":null,\"exemptionCertificate\":null,\"taxRegistration\":[],\"isTaxExempt\":false,\"exemptionReasonCode\":null},\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"discount\":null,\"subTotal\":147,\"total\":158.9,\"totalTax\":11.9,\"lineItem\":[{\"seller\":null,\"customer\":null,\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"product\":{\"value\":\"0021765045\",\"productClass\":\"89998\"},\"commodityCode\":null,\"quantity\":{\"value\":1,\"unitOfMeasure\":null},\"weight\":null,\"volume\":null,\"supplementaryUnit\":null,\"statisticalValue\":null,\"freight\":null,\"fairMarketValue\":140,\"unitPrice\":null,\"extendedPrice\":140,\"discount\":null,\"amountBilledToDate\":null,\"taxes\":[{\"jurisdiction\":{\"value\":\"CALIFORNIA\",\"jurisdictionLevel\":\"STATE\",\"jurisdictionId\":2398,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":8.4,\"effectiveRate\":0.06,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":1262305,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"SAN FRANCISCO\",\"jurisdictionLevel\":\"COUNTY\",\"jurisdictionId\":3685,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":1.75,\"effectiveRate\":0.0125,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":1080563,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"TRANSPORTATION AUTHORITY (SFTA)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":66690,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0.7,\"effectiveRate\":0.005,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":25472,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"PUBLIC FINANCE AUTHORITY (SFPF)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":66691,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0.35,\"effectiveRate\":0.0025,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":25474,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"BAY AREA RAPID TRANSIT DISTRICT (BART)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":78112,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0.7,\"effectiveRate\":0.005,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":26636,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"}],\"totalTax\":11.9,\"flexibleFields\":null,\"returnsFields\":null,\"assistedParameters\":null,\"lineItem\":[],\"lineItemNumber\":1,\"taxDate\":null,\"isMulticomponent\":null,\"locationCode\":null,\"deliveryTerm\":null,\"postingDate\":null,\"costCenter\":null,\"departmentCode\":null,\"generalLedgerAccount\":null,\"materialCode\":null,\"projectNumber\":null,\"usage\":null,\"usageClass\":null,\"vendorSKU\":null,\"countryOfOriginISOCode\":null,\"modeOfTransport\":null,\"natureOfTransaction\":null,\"intrastatCommodityCode\":null,\"netMassKilograms\":null,\"lineItemId\":\"testCommerceItemId\",\"taxIncludedIndicator\":null,\"transactionType\":null,\"simplificationCode\":null,\"titleTransfer\":null,\"chainTransactionPhase\":null,\"exportProcedure\":null},{\"seller\":null,\"customer\":null,\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"product\":{\"value\":\"Freight\",\"productClass\":\"40000\"},\"commodityCode\":null,\"quantity\":{\"value\":1,\"unitOfMeasure\":null},\"weight\":null,\"volume\":null,\"supplementaryUnit\":null,\"statisticalValue\":null,\"freight\":null,\"fairMarketValue\":7,\"unitPrice\":null,\"extendedPrice\":7,\"discount\":null,\"amountBilledToDate\":null,\"taxes\":[{\"jurisdiction\":{\"value\":\"CALIFORNIA\",\"jurisdictionLevel\":\"STATE\",\"jurisdictionId\":2398,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":7,\"taxable\":0,\"imposition\":{\"value\":\"Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":3557,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NONTAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":\"0834\",\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null},{\"jurisdiction\":{\"value\":\"SAN FRANCISCO\",\"jurisdictionLevel\":\"COUNTY\",\"jurisdictionId\":3685,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":7,\"taxable\":0,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":1080563,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NONTAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":\"0834\",\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null},{\"jurisdiction\":{\"value\":\"TRANSPORTATION AUTHORITY (SFTA)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":66690,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":7,\"taxable\":0,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":25472,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NONTAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":\"0834\",\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null},{\"jurisdiction\":{\"value\":\"PUBLIC FINANCE AUTHORITY (SFPF)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":66691,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":7,\"taxable\":0,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":25474,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NONTAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":\"0834\",\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null},{\"jurisdiction\":{\"value\":\"BAY AREA RAPID TRANSIT DISTRICT (BART)\",\"jurisdictionLevel\":\"DISTRICT\",\"jurisdictionId\":78112,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":7,\"taxable\":0,\"imposition\":{\"value\":\"Local Sales and Use Tax\",\"userDefined\":null,\"impositionId\":1},\"impositionType\":{\"value\":\"General Sales and Use Tax\",\"userDefined\":null,\"impositionTypeId\":1},\"taxRuleId\":{\"value\":26636,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NONTAXABLE\",\"taxType\":\"SALES\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":\"0834\",\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null}],\"totalTax\":0,\"flexibleFields\":null,\"returnsFields\":null,\"assistedParameters\":null,\"lineItem\":[],\"lineItemNumber\":2,\"taxDate\":null,\"isMulticomponent\":null,\"locationCode\":null,\"deliveryTerm\":null,\"postingDate\":null,\"costCenter\":null,\"departmentCode\":null,\"generalLedgerAccount\":null,\"materialCode\":null,\"projectNumber\":null,\"usage\":null,\"usageClass\":null,\"vendorSKU\":null,\"countryOfOriginISOCode\":null,\"modeOfTransport\":null,\"natureOfTransaction\":null,\"intrastatCommodityCode\":null,\"netMassKilograms\":null,\"lineItemId\":\"testShippingGroupId\",\"taxIncludedIndicator\":null,\"transactionType\":null,\"simplificationCode\":null,\"titleTransfer\":null,\"chainTransactionPhase\":null,\"exportProcedure\":null}],\"documentNumber\":\"testTaxesOrderId01\",\"documentType\":null,\"billingType\":null,\"orderType\":null,\"postingDate\":null,\"locationCode\":null,\"returnAssistedParametersIndicator\":null,\"returnGeneratedLineItemsIndicator\":null,\"deliveryTerm\":null,\"documentDate\":\"2020-03-02T05:00:00.000+0000\",\"transactionId\":null,\"transactionType\":\"SALE\",\"simplificationCode\":null,\"roundAtLineLevel\":null,\"paymentDate\":null,\"documentSequenceId\":null}";
		try {
			ObjectMapper mapper = new ObjectMapper();
			mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
			return mapper.readValue(jsonStr, QuotationResponseType.class);
		} catch (IOException e) {
			e.printStackTrace();
		}
		return null;
	}
	
	private QuotationResponseType mockVertexResponseCanada() {
		String jsonStr = "{\"currency\":null,\"originalCurrency\":null,\"seller\":{\"company\":\"AEHoldings\",\"division\":\"AEDCND\",\"department\":null,\"dispatcher\":null,\"physicalOrigin\":null,\"administrativeOrigin\":null,\"taxRegistration\":[],\"nexusIndicator\":null,\"nexusReasonCode\":null},\"customer\":{\"customerCode\":null,\"destination\":{\"streetAddress1\":\"10 Bay St\",\"streetAddress2\":\"Suite 10\",\"city\":\"Toronto\",\"mainDivision\":\"ON\",\"subDivision\":null,\"postalCode\":\"M5J 2X2\",\"country\":\"CA\",\"currencyConversion\":null,\"taxAreaId\":700151420,\"locationCustomsStatus\":null,\"locationCode\":null,\"externalJurisdictionCode\":null},\"administrativeDestination\":null,\"exemptionCertificate\":null,\"taxRegistration\":[],\"isTaxExempt\":false,\"exemptionReasonCode\":null},\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"discount\":null,\"subTotal\":147,\"total\":166.11,\"totalTax\":19.11,\"lineItem\":[{\"seller\":null,\"customer\":null,\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"product\":{\"value\":\"0021765045\",\"productClass\":\"89998\"},\"commodityCode\":null,\"quantity\":{\"value\":1,\"unitOfMeasure\":null},\"weight\":null,\"volume\":null,\"supplementaryUnit\":null,\"statisticalValue\":null,\"freight\":null,\"fairMarketValue\":140,\"unitPrice\":null,\"extendedPrice\":140,\"discount\":null,\"amountBilledToDate\":null,\"taxes\":[{\"jurisdiction\":{\"value\":\"CANADA\",\"jurisdictionLevel\":\"COUNTRY\",\"jurisdictionId\":8,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":18.2,\"effectiveRate\":0.13,\"exempt\":null,\"nonTaxable\":null,\"taxable\":140,\"imposition\":{\"value\":\"GST/HST\",\"userDefined\":null,\"impositionId\":3},\"impositionType\":{\"value\":\"Goods and Services Tax\",\"userDefined\":null,\"impositionTypeId\":43},\"taxRuleId\":{\"value\":308361,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[21],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"VAT\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":\"OUTPUT\",\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":5,\"isService\":null,\"rateClassification\":\"Standard Rate\",\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"ONTARIO\",\"jurisdictionLevel\":\"PROVINCE\",\"jurisdictionId\":44315,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":null,\"taxable\":0,\"imposition\":null,\"impositionType\":null,\"taxRuleId\":null,\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[21],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NO_TAX\",\"taxType\":\"NONE\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null}],\"totalTax\":18.2,\"flexibleFields\":null,\"returnsFields\":null,\"assistedParameters\":null,\"lineItem\":[],\"lineItemNumber\":1,\"taxDate\":null,\"isMulticomponent\":null,\"locationCode\":null,\"deliveryTerm\":null,\"postingDate\":null,\"costCenter\":null,\"departmentCode\":null,\"generalLedgerAccount\":null,\"materialCode\":null,\"projectNumber\":null,\"usage\":null,\"usageClass\":null,\"vendorSKU\":null,\"countryOfOriginISOCode\":null,\"modeOfTransport\":null,\"natureOfTransaction\":null,\"intrastatCommodityCode\":null,\"netMassKilograms\":null,\"lineItemId\":\"testCommerceItemId\",\"taxIncludedIndicator\":null,\"transactionType\":null,\"simplificationCode\":null,\"titleTransfer\":null,\"chainTransactionPhase\":null,\"exportProcedure\":null},{\"seller\":null,\"customer\":null,\"taxOverride\":null,\"impositionToProcess\":[],\"jurisdictionOverride\":[],\"situsOverride\":null,\"product\":{\"value\":\"Freight\",\"productClass\":\"40000\"},\"commodityCode\":null,\"quantity\":{\"value\":1,\"unitOfMeasure\":null},\"weight\":null,\"volume\":null,\"supplementaryUnit\":null,\"statisticalValue\":null,\"freight\":null,\"fairMarketValue\":7,\"unitPrice\":null,\"extendedPrice\":7,\"discount\":null,\"amountBilledToDate\":null,\"taxes\":[{\"jurisdiction\":{\"value\":\"CANADA\",\"jurisdictionLevel\":\"COUNTRY\",\"jurisdictionId\":8,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0.91,\"effectiveRate\":0.13,\"exempt\":null,\"nonTaxable\":null,\"taxable\":7,\"imposition\":{\"value\":\"GST/HST\",\"userDefined\":null,\"impositionId\":3},\"impositionType\":{\"value\":\"Goods and Services Tax\",\"userDefined\":null,\"impositionTypeId\":43},\"taxRuleId\":{\"value\":1124659,\"userDefined\":null,\"salesTaxHolidayIndicator\":null},\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[21],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"TAXABLE\",\"taxType\":\"VAT\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":\"OUTPUT\",\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":\"SINGLE_RATE\"},{\"jurisdiction\":{\"value\":\"ONTARIO\",\"jurisdictionLevel\":\"PROVINCE\",\"jurisdictionId\":44315,\"effectiveDate\":null,\"expirationDate\":null,\"externalJurisdictionCode\":null},\"calculatedTax\":0,\"effectiveRate\":0,\"exempt\":null,\"nonTaxable\":null,\"taxable\":0,\"imposition\":null,\"impositionType\":null,\"taxRuleId\":null,\"basisRuleId\":null,\"maxTaxRuleId\":null,\"recoverableRuleId\":null,\"certificateNumber\":null,\"recoverableAmount\":null,\"recoverablePercent\":null,\"blockingRecoverablePercent\":null,\"partialExemptRecoverablePercent\":null,\"unrecoverableAmount\":null,\"filingCurrencyAmounts\":null,\"sellerRegistrationId\":null,\"buyerRegistrationId\":null,\"ownerRegistrationId\":null,\"dispatcherRegistrationId\":null,\"recipientRegistrationId\":null,\"invoiceTextCode\":[21],\"summaryInvoiceText\":null,\"assistedParameters\":null,\"taxResult\":\"NO_TAX\",\"taxType\":\"NONE\",\"maxTaxIndicator\":null,\"situs\":\"DESTINATION\",\"notRegisteredIndicator\":null,\"inputOutputType\":null,\"taxCode\":null,\"vertexTaxCode\":null,\"reasonCode\":null,\"filingCategoryCode\":null,\"isService\":null,\"rateClassification\":null,\"taxCollectedFromParty\":\"BUYER\",\"taxStructure\":null}],\"totalTax\":0.91,\"flexibleFields\":null,\"returnsFields\":null,\"assistedParameters\":null,\"lineItem\":[],\"lineItemNumber\":2,\"taxDate\":null,\"isMulticomponent\":null,\"locationCode\":null,\"deliveryTerm\":null,\"postingDate\":null,\"costCenter\":null,\"departmentCode\":null,\"generalLedgerAccount\":null,\"materialCode\":null,\"projectNumber\":null,\"usage\":null,\"usageClass\":null,\"vendorSKU\":null,\"countryOfOriginISOCode\":null,\"modeOfTransport\":null,\"natureOfTransaction\":null,\"intrastatCommodityCode\":null,\"netMassKilograms\":null,\"lineItemId\":\"testShippingGroupId\",\"taxIncludedIndicator\":null,\"transactionType\":null,\"simplificationCode\":null,\"titleTransfer\":null,\"chainTransactionPhase\":null,\"exportProcedure\":null}],\"documentNumber\":\"testTaxesOrderId01\",\"documentType\":null,\"billingType\":null,\"orderType\":null,\"postingDate\":null,\"locationCode\":null,\"returnAssistedParametersIndicator\":null,\"returnGeneratedLineItemsIndicator\":null,\"deliveryTerm\":null,\"documentDate\":\"2020-03-02T05:00:00.000+0000\",\"transactionId\":null,\"transactionType\":\"SALE\",\"simplificationCode\":null,\"roundAtLineLevel\":null,\"paymentDate\":null,\"documentSequenceId\":null}";
		try {
			ObjectMapper mapper = new ObjectMapper();
			mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
			return mapper.readValue(jsonStr, QuotationResponseType.class);
		} catch (IOException e) {
			e.printStackTrace();
		}
		return null;
	}

}
