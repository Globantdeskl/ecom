<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             https://maven.apache.org/xsd/maven-4.0.0.xsd">

    <!-- ===================================================== -->
    <!-- Project Coordinates                                  -->
    <!-- ===================================================== -->
    <modelVersion>4.0.0</modelVersion>

    <groupId>kundli</groupId>
    <artifactId>kundli</artifactId>
    <version>0.0.1</version>
    <packaging>jar</packaging>

    <name>kundli</name>
    <description>Kundli – Enterprise Spring Boot AWS Lambda Application</description>

    <!-- ===================================================== -->
    <!-- Parent (Spring Boot BOM)                              -->
    <!-- ===================================================== -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.1</version>
        <relativePath/>
    </parent>

    <!-- ===================================================== -->
    <!-- Global Properties                                    -->
    <!-- ===================================================== -->
    <properties>
        <!-- Java -->
        <java.version>17</java.version>

        <!-- AWS Lambda -->
        <aws.serverless.version>2.0.0</aws.serverless.version>

        <!-- Build / Encoding -->
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    </properties>

    <!-- ===================================================== -->
    <!-- Dependencies                                         -->
    <!-- ===================================================== -->
   <dependencies>

    <!-- ================= Spring Core ================= -->

    <!-- Web (REST / HTTP APIs) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>
    
  <dependency>
  <groupId>org.projectlombok</groupId>
  <artifactId>lombok</artifactId>
  <optional>true</optional>
</dependency>


    <!-- Security: OAuth2 Resource Server (JWT) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-oauth2-resource-server</artifactId>
    </dependency>

    <!-- ================= Data Layer ================= -->

    <!-- Spring Data JPA (MANDATORY if using DB) -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>

    <!-- ================= Databases ================= -->

    <!-- H2 (DEV / TEST only – Embedded DB) -->
    <dependency>
        <groupId>com.h2database</groupId>
        <artifactId>h2</artifactId>
        <scope>runtime</scope>
    </dependency>

    <!-- MySQL (PROD / Optional DEV) -->
    <dependency>
        <groupId>com.mysql</groupId>
        <artifactId>mysql-connector-j</artifactId>
        <scope>runtime</scope>
    </dependency>

	<!-- Micrometer Tracing -->
	<dependency>
	    <groupId>io.micrometer</groupId>
	    <artifactId>micrometer-tracing-bridge-otel</artifactId>
	</dependency>
	
	<!-- OpenTelemetry OTLP exporter (Jaeger) -->
	<dependency>
	    <groupId>io.opentelemetry</groupId>
	    <artifactId>opentelemetry-exporter-otlp</artifactId>
	</dependency>


    <!-- ================= Cache ================= -->

    <!-- Redis -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>

    <!-- ================= AWS Lambda ================= -->

    <!-- AWS Lambda Spring Boot 3 Container -->
    <dependency>
        <groupId>com.amazonaws.serverless</groupId>
        <artifactId>aws-serverless-java-container-springboot3</artifactId>
        <version>${aws.serverless.version}</version>
    </dependency>

    <!-- ================= Testing ================= -->

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    
</dependencies>

	<dependencyManagement>
		<dependencies>

        <!-- ✅ Resilience4j BOM -->
        <dependency>
            <groupId>io.github.resilience4j</groupId>
            <artifactId>resilience4j-bom</artifactId>
            <version>2.2.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>io.opentelemetry</groupId>
            <artifactId>opentelemetry-bom</artifactId>
            <version>1.38.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>

        <!-- ✅ OpenTelemetry instrumentation BOM (THIS WAS MISSING) -->
        <dependency>
            <groupId>io.opentelemetry.instrumentation</groupId>
            <artifactId>opentelemetry-instrumentation-bom</artifactId>
            <version>2.5.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
		</dependencies>
	</dependencyManagement>


    <!-- ===================================================== -->
    <!-- Build Profiles (Enterprise Standard)                  -->
    <!-- ===================================================== -->
    <profiles>

        <!-- Local development -->
        <profile>
            <id>local</id>
            <properties>
                <spring.profiles.active>local</spring.profiles.active>
            </properties>
        </profile>

        <!-- AWS Lambda -->
        <profile>
            <id>lambda</id>
            <properties>
                <spring.profiles.active>lambda</spring.profiles.active>
            </properties>
        </profile>

    </profiles>
    
   <build>
  <plugins>
    <plugin>
      <groupId>com.google.cloud.tools</groupId>
      <artifactId>jib-maven-plugin</artifactId>
      <version>3.4.0</version>

      <configuration>
        <from>
          <image>eclipse-temurin:17-jre</image>
        </from>

        <to>
          <image>sheknar83/my-app</image>
          <tags>
            <tag>latest</tag>
          </tags>
           <auth>
		    <username>sheknar83</username>
		    <password>Latika@123!</password>
		  </auth>
        </to>

        <container>
          <jvmFlags>
            <jvmFlag>-XX:+UseG1GC</jvmFlag>
            <jvmFlag>-XX:MaxRAMPercentage=75</jvmFlag>
            <jvmFlag>-XX:InitialRAMPercentage=50</jvmFlag>
            <jvmFlag>-Xlog:gc*</jvmFlag>
            <jvmFlag>-XX:+HeapDumpOnOutOfMemoryError</jvmFlag>
            <jvmFlag>-XX:+ExitOnOutOfMemoryError</jvmFlag>
            <jvmFlag>-Dspring.profiles.active=prod</jvmFlag>
          </jvmFlags>

          <ports>
            <port>8080</port>
          </ports>
        </container>
      </configuration>
    </plugin>
  </plugins>
</build>

</project>
