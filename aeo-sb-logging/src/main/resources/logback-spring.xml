<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="false">

	<appender name="CONSOLE_APPENDER" class="ch.qos.logback.core.ConsoleAppender">
        <withJansi>true</withJansi>
        <encoder>
            <Pattern>
                %green(%d{yyyy-MM-dd HH:mm:ss.SSS}) %highlight(%-5level) [%thread] %cyan(%-10logger{36}) - %msg%n
            </Pattern>
        </encoder>
    </appender>
    
    <!-- structured logging usage: https://www.innoq.com/en/blog/structured-logging/ -->
    <!-- settings: https://github.com/logstash/logstash-logback-encoder -->
    <appender name="LOGSTASH_APPENDER" class="ch.qos.logback.core.ConsoleAppender">
    	<encoder class="net.logstash.logback.encoder.LogstashEncoder">
          	<fieldNames>
              	<timestamp>app_timestamp</timestamp>
          	</fieldNames>
    		<timeZone>America/New_York</timeZone>
        	<timestampPattern>yyyy-MM-dd'T'HH:mm:ss.SSS'Z'</timestampPattern>
        	<includeMdc>true</includeMdc>
        	<excludeMdcKeyName>X-B3-TraceId</excludeMdcKeyName>
        	<excludeMdcKeyName>spanExportable</excludeMdcKeyName>
        	<excludeMdcKeyName>X-Span-Export</excludeMdcKeyName>
        	<excludeMdcKeyName>X-B3-SpanId</excludeMdcKeyName>
        	<mdcKeyFieldName>X-B3-ParentSpanId=parent_span_id</mdcKeyFieldName>
        	<mdcKeyFieldName>traceId=trace_id</mdcKeyFieldName>
        	<mdcKeyFieldName>spanId=span_id</mdcKeyFieldName>
    	</encoder>
    </appender>

	<springProfile name="default">
	    <logger name="ROOT" level="INFO" additivity="false">
            <appender-ref ref="CONSOLE_APPENDER" />
        </logger>
    </springProfile>
    
    <springProfile name="cloud">
    	<logger name="ROOT" level="INFO" additivity="false">
            <appender-ref ref="LOGSTASH_APPENDER" />
        </logger>
    </springProfile>
    
    <springProfile name="kubernetes">
    	<logger name="ROOT" level="INFO" additivity="false">
            <appender-ref ref="LOGSTASH_APPENDER" />
        </logger>
    </springProfile>
    
</configuration>
